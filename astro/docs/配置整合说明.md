# 🔧 配置整合说明

## 📋 **概述**

本系统实现了 `config.ts` 静态配置与 Strapi `Index Settings` 动态配置的智能整合，让你可以：

1. **在 Strapi 后台动态修改**网站配置（推荐）
2. **在 config.ts 中设置默认值**作为备用
3. **自动优先级处理**：Strapi 设置 > config.ts 默认值

## 🎯 **配置优先级**

```
Strapi Index Settings（动态，优先级最高）
    ↓ 如果获取失败或未设置
config.ts（静态，作为备用）
    ↓ 如果都没有
系统默认值
```

## 📊 **配置对应关系**

### **1. 网站基本信息**

| 配置项 | Strapi 字段 | config.ts 字段 | 说明 |
|--------|-------------|----------------|------|
| 网站标题 | `site_title` | `siteConfig.title` | 显示在浏览器标题栏 |
| 网站副标题 | `site_subtitle` | `siteConfig.subtitle` | 显示在首页 |
| 网站描述 | `site_description` | - | SEO描述 |
| 网站语言 | - | `siteConfig.lang` | 固定为 zh_CN |
| 主题色调 | - | `siteConfig.themeColor.hue` | 0-360 |

### **2. LOGO配置**

| 配置项 | Strapi 字段 | config.ts 字段 | 说明 |
|--------|-------------|----------------|------|
| 浅色模式LOGO | `logo_light` | - | 浅色主题下显示 |
| 深色模式LOGO | `logo_dark` | - | 深色主题下显示 |
| LOGO备用文字 | - | `siteConfig.title` | 图片加载失败时显示 |

### **3. 布局配置**

| 配置项 | Strapi 字段 | config.ts 字段 | 说明 |
|--------|-------------|----------------|------|
| 首页布局 | `default_homepage_layout` | - | grid/masonry/list |
| 显示作者区域 | `show_author_section` | - | 是否显示侧边栏作者信息 |

## 🔧 **如何配置**

### **方法1：Strapi 后台配置（推荐）**

1. 访问 Strapi 后台：`http://localhost:1337/admin`
2. 进入 `Content Manager` → `Index`
3. 编辑或创建 Index 条目
4. 配置以下字段：
   - **Site Title**: 网站标题
   - **Site Subtitle**: 网站副标题  
   - **Site Description**: 网站描述
   - **Logo Light**: 浅色模式LOGO图片
   - **Logo Dark**: 深色模式LOGO图片
   - **Default Homepage Layout**: 首页布局
   - **Show Author Section**: 是否显示作者区域

### **方法2：config.ts 静态配置（备用）**

编辑 `astro/src/config.ts`：

```typescript
export const siteConfig: SiteConfig = {
  title: "你的网站标题",           // 默认标题
  subtitle: "你的网站副标题",       // 默认副标题
  lang: "zh_CN",                  // 网站语言
  themeColor: {
    hue: 260,                     // 主题色调 0-360
    fixed: false,                 // 是否允许用户自定义主题色
  },
};
```

## 🚀 **使用方法**

### **在组件中使用整合配置**

```typescript
// 获取完整配置
import { getIntegratedConfig } from "../lib/config-integration";
const config = await getIntegratedConfig();

// 获取特定配置
import { getSiteConfig, getLogoConfig, getLayoutConfig } from "../lib/config-integration";

// 网站基本信息
const siteConfig = await getSiteConfig();
console.log(siteConfig.title); // 优先使用Strapi设置

// LOGO配置
const logoConfig = await getLogoConfig();
console.log(logoConfig.light); // Strapi LOGO URL

// 布局配置
const layoutConfig = await getLayoutConfig();
console.log(layoutConfig.defaultHomepageLayout); // grid/masonry/list
```

### **缓存机制**

系统自动缓存配置5分钟，提高性能：

```typescript
// 获取缓存配置（推荐）
import { getCachedConfig } from "../lib/config-integration";
const config = await getCachedConfig();

// 清除缓存（如需要）
import { clearConfigCache } from "../lib/config-integration";
clearConfigCache();
```

## 🎨 **LOGO配置详解**

### **LOGO显示逻辑**

1. **有Strapi LOGO**：显示图片 + 文字标题
2. **无Strapi LOGO**：只显示文字标题
3. **图片加载失败**：自动回退到文字标题

### **主题切换支持**

- **浅色模式**：显示 `logo_light`
- **深色模式**：显示 `logo_dark`
- **单一LOGO**：两种模式都显示同一张图片

### **LOGO路径处理**

```typescript
// Strapi LOGO自动添加域名前缀（使用环境变量）
const strapiUrl = import.meta.env.STRAPI_PUBLIC_URL || import.meta.env.STRAPI_URL;
const logoUrl = `${strapiUrl}${strapiLogo.url}`;

// 支持相对路径和绝对路径（使用环境变量）
const logoConfig = {
  light: `${strapiUrl}/uploads/logo-light.png`,
  dark: `${strapiUrl}/uploads/logo-dark.png`,
  alt: "网站LOGO",
  fallbackText: "网站标题"
};
```

## 🔍 **调试和故障排除**

### **检查配置加载**

在浏览器控制台查看：

```javascript
// 开发环境会显示配置加载信息
console.log('🔧 配置加载状态:', {
  strapiAvailable: true/false,
  logoConfig: {...},
  siteConfig: {...}
});
```

### **常见问题**

1. **LOGO不显示**：
   - 检查Strapi中是否上传了LOGO图片
   - 确认图片URL是否正确
   - 查看浏览器网络面板是否有404错误

2. **配置不生效**：
   - 清除配置缓存：`clearConfigCache()`
   - 检查Strapi服务是否正常运行
   - 确认Index Settings是否已发布

3. **性能问题**：
   - 配置会自动缓存5分钟
   - 避免频繁调用配置函数
   - 使用 `getCachedConfig()` 获取缓存配置

## 📝 **最佳实践**

1. **优先使用Strapi配置**：便于动态修改，无需重新部署
2. **config.ts作为备用**：确保在Strapi不可用时网站仍能正常运行
3. **合理使用缓存**：避免频繁的API调用
4. **图片优化**：LOGO图片建议使用PNG格式，大小控制在100KB以内
5. **测试回退机制**：确保在各种情况下网站都能正常显示

## 🎉 **总结**

通过配置整合系统，你可以：

- ✅ **灵活配置**：Strapi后台动态修改 + config.ts静态备用
- ✅ **智能回退**：自动处理配置获取失败的情况
- ✅ **性能优化**：自动缓存机制，减少API调用
- ✅ **类型安全**：完整的TypeScript类型支持
- ✅ **易于维护**：清晰的配置优先级和使用方法
