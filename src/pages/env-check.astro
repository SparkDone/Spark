---
/**
 * ç¯å¢ƒå˜é‡æ£€æŸ¥é¡µé¢
 */

// æ£€æŸ¥å…³é”®ç¯å¢ƒå˜é‡
const envCheck = {
  NODE_ENV: import.meta.env.NODE_ENV,
  PROD: import.meta.env.PROD,
  DEV: import.meta.env.DEV,
  MODE: import.meta.env.MODE,
  STRAPI_URL: import.meta.env.STRAPI_URL ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®',
  STRAPI_API_TOKEN: import.meta.env.STRAPI_API_TOKEN ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®',
  PUBLIC_STRAPI_URL: import.meta.env.PUBLIC_STRAPI_URL ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®',
};

// æµ‹è¯•APIè¿æ¥
let apiTest = {
  status: 'æµ‹è¯•ä¸­...',
  error: null,
  data: null
};

try {
  const response = await fetch('/api/search/?q=test');
  if (response.ok) {
    const data = await response.json();
    apiTest = {
      status: 'âœ… APIè¿æ¥æ­£å¸¸',
      error: null,
      data: data
    };
  } else {
    apiTest = {
      status: 'âŒ APIå“åº”é”™è¯¯',
      error: `HTTP ${response.status}: ${response.statusText}`,
      data: null
    };
  }
} catch (error) {
  apiTest = {
    status: 'âŒ APIè¿æ¥å¤±è´¥',
    error: error.message,
    data: null
  };
}
---

<html>
<head>
    <meta charset="UTF-8">
    <title>ç¯å¢ƒæ£€æŸ¥</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .section { border: 1px solid #ddd; margin: 20px 0; padding: 15px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç¯å¢ƒæ£€æŸ¥</h1>

    <div class="section">
        <h2>ğŸ“Š ç¯å¢ƒå˜é‡</h2>
        <table>
            <tr><th>å˜é‡å</th><th>çŠ¶æ€</th></tr>
            {Object.entries(envCheck).map(([key, value]) => (
                <tr>
                    <td>{key}</td>
                    <td class={value.includes('âœ…') ? 'success' : value.includes('âŒ') ? 'error' : ''}>{value}</td>
                </tr>
            ))}
        </table>
    </div>

    <div class="section">
        <h2>ğŸ” APIæµ‹è¯•</h2>
        <p><strong>çŠ¶æ€:</strong> <span class={apiTest.status.includes('âœ…') ? 'success' : 'error'}>{apiTest.status}</span></p>
        
        {apiTest.error && (
            <div>
                <p><strong>é”™è¯¯:</strong> <span class="error">{apiTest.error}</span></p>
            </div>
        )}
        
        {apiTest.data && (
            <div>
                <p><strong>APIå“åº”:</strong></p>
                <pre>{JSON.stringify(apiTest.data, null, 2)}</pre>
            </div>
        )}
    </div>

    <div class="section">
        <h2>ğŸŒ è¿è¡Œæ—¶ä¿¡æ¯</h2>
        <table>
            <tr><td>ç”¨æˆ·ä»£ç†</td><td id="userAgent">-</td></tr>
            <tr><td>å½“å‰URL</td><td id="currentUrl">-</td></tr>
            <tr><td>æ—¶é—´æˆ³</td><td>{new Date().toISOString()}</td></tr>
        </table>
    </div>

    <div class="section">
        <h2>ğŸ§ª å®æ—¶æœç´¢æµ‹è¯•</h2>
        <div>
            <input type="text" id="testInput" placeholder="è¾“å…¥æœç´¢å…³é”®è¯..." value="11" style="padding: 8px; width: 200px;">
            <button onclick="testSearch()" style="padding: 8px 16px;">æµ‹è¯•æœç´¢</button>
        </div>
        <div id="testResult" style="margin-top: 10px;"></div>
    </div>

    <script>
        // å¡«å……è¿è¡Œæ—¶ä¿¡æ¯
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('currentUrl').textContent = window.location.href;

        // æœç´¢æµ‹è¯•å‡½æ•°
        async function testSearch() {
            const input = document.getElementById('testInput');
            const result = document.getElementById('testResult');
            
            const query = input.value.trim();
            if (!query) {
                result.innerHTML = '<span class="error">è¯·è¾“å…¥æœç´¢å…³é”®è¯</span>';
                return;
            }
            
            result.innerHTML = '<span>æœç´¢ä¸­...</span>';
            
            try {
                const response = await fetch(`/api/search/?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    result.innerHTML = `
                        <div class="success">âœ… æ‰¾åˆ° ${data.data.length} ä¸ªç»“æœ</div>
                        <pre>${JSON.stringify(data.data.slice(0, 2), null, 2)}</pre>
                    `;
                } else {
                    result.innerHTML = `<div class="error">âŒ æœç´¢å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨æµ‹è¯•
        setTimeout(testSearch, 1000);
    </script>
</body>
</html>
